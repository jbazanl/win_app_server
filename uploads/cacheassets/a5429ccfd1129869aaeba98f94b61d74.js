var is_save_card = 'no';var debug_mode = true;function scrollToId(targetEle){var $targetEle = $(targetEle);$('html, body').stop().animate({'scrollTop': $targetEle.offset().top}, 800, 'swing', function (){});}$('#btnPayment').click(function (){$('#st-message-stripe').html('');$("#payment_form").parsley().reset();var is_ok = $("#payment_form").parsley().isValid();if (is_ok === true){Stripe.setPublishableKey(STRIPE_PUBLISHABLE_KEY);function stripeResponseHandler(status, response){if (response.error){$('#st-message-stripe').html('<p class="st-error">' + response.error.message + '</p>');$('#st-message-stripe').removeClass('hide');scrollToId('#st-message-stripe');} else {var token = response['id'];var target_initiate = BASE_URL + 'stripe/ajax_initiate_payment';var data = {account_id: account_id,amount: $('#amount').val(),cachetoken: token,method: "stripe",card_number: $('id_card_number').val(),card_expirymonth: $('#id_expirymonth').val(),card_expiryyear: $('#id_expirymonth').val(),};$('#st-message-stripe').html('');$.ajax({url: target_initiate,dataType: 'json',type: 'POST',data: data,success: function (data, textStatus, XMLHttpRequest){if (data.valid){if (debug_mode)console.log('stripe_cliant_initiate_payment valid');$("#payment_form").append("<input type='hidden' name='stripetoken' value='" + token + "' />");$("#payment_form").submit();} else{$('#btnPayment').attr('disabled', false);$('#st-message-stripe').html('<p class="st-error">' + data.error + '</p>');$('#st-message-stripe').removeClass('hide');scrollToId('#st-message-stripe');if (debug_mode)console.log('stripe_cliant_initiate_payment failed1');}},error: function (XMLHttpRequest, textStatus, errorThrown){$('#st-message-stripe').removeClass('hide');$('#btnPayment').attr('disabled', false);$('#st-message-stripe').html('<p class="st-error">Something bad happened.Please try again after some time.</p>');scrollToId('#st-message-stripe');if (debug_mode){console.log('stripe_cliant_initiate_payment failed2');console.log(errorThrown);}}});}}Stripe.createToken({number: $('#id_card_number').val(),cvc: $('#id_securitycode').val(),exp_month: $('#id_expirymonth').val(),exp_year: $('#id_expiryyear').val()}, stripeResponseHandler);} else{$("#payment_form").parsley().validate();}});